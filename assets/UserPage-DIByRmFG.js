import{ab as K,r as $,ac as X,d as R,V as B,b as D,c as Q,f as k,j as A,w as i,l as a,i as e,t as s,C as _,ad as E,D as q,ae as M,E as S,af as Y,ag as V,_ as z,R as x,y as ee,ah as te,U as oe,ai as se,o as le,e as T,k as P,S as N,aj as U,m as w,ak as Z}from"./index-CC0sAWIH.js";import{Q as ae}from"./QPage-Digx5baL.js";import{d as j,l as O}from"./MomPosMainPageDark-BsLCBqY-.js";const re=K("user",()=>{const C=$(null);return{user:C,fetchUserInfo:async c=>{try{const u=await X(c);C.value=u}catch(u){console.error("Error fetching user info:",u)}},logout:()=>{C.value=null}}}),ne={class:"text-h6 text-center"},ue={class:"flex-center"},ie=["src"],de=R({__name:"RegisterComponent",setup(C){const{t:o}=B(),r=$(""),c=$(""),u=$(""),h=D(),b=Q(()=>h.isDarkMode?j:O),v=async()=>{const m=(()=>{let l="";return(r.value.length<6||r.value.length>20)&&(l+=`${o("accountLengthError")} `),/^[a-zA-Z0-9._]+$/.test(r.value)||(l+=`${o("accountSpecialCharError")} `),/[_\.]{2,}/.test(r.value)&&(l+=`${o("accountConsecutiveError")} `),(!/^[a-zA-Z0-9]/.test(r.value)||!/[a-zA-Z0-9]$/.test(r.value))&&(l+=`${o("accountStartEndError")} `),/\b(admin|root)\b/.test(r.value)&&(l+=`${o("accountReservedWordError")} `),(c.value.length<8||c.value.length>20)&&(l+=`${o("passwordLengthError")} `),(!/[a-zA-Z]/.test(c.value)||!/\d/.test(c.value))&&(l+=`${o("passwordComplexityError")} `),l})();if(m){V.create({type:"negative",message:m.trim()});return}try{await Y({account:r.value,password:c.value,name:u.value}),V.create({type:"positive",message:o("registerSuccess")}),setTimeout(()=>{window.location.reload()},2e3)}catch(l){V.create({type:"negative",message:l.message||o("registerFailed")})}};return(g,m)=>(k(),A(S,{class:"rounded-borders"},{default:i(()=>[a(_,null,{default:i(()=>[e("div",ne,s(g.$t("register")),1)]),_:1}),a(_,null,{default:i(()=>[e("div",ue,[e("img",{src:b.value,"spinner-color":"white",class:"login-image"},null,8,ie)]),a(E,{modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=l=>u.value=l),label:g.$t("userName"),outlined:"",dense:""},null,8,["modelValue","label"]),a(E,{modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=l=>r.value=l),label:g.$t("account"),outlined:"",dense:""},null,8,["modelValue","label"]),a(E,{modelValue:c.value,"onUpdate:modelValue":m[2]||(m[2]=l=>c.value=l),label:g.$t("password"),type:"password",outlined:"",dense:""},null,8,["modelValue","label"])]),_:1}),a(M,{align:"center",class:"card-margin"},{default:i(()=>[a(q,{label:g.$t("register"),color:"primary",onClick:v,disable:!r.value||!c.value||!u.value},null,8,["label","disable"]),a(q,{label:g.$t("backToLogin"),color:"secondary",onClick:m[3]||(m[3]=l=>g.$emit("open-login"))},null,8,["label"])]),_:1})]),_:1}))}}),ce=z(de,[["__scopeId","data-v-9bcbe530"]]),ve={class:"text-h6 text-center"},me={class:"flex-center"},pe=["src"],ge={style:{"font-size":"1rem","text-align":"center","margin-bottom":"1rem"}},fe=R({__name:"LoginComponent",setup(C){const o=$(""),r=$(""),c=x(),u=ee(),h=typeof c.query.from=="string"?c.query.from:"/",b=D(),{t:v}=B(),g=async()=>{const f=(()=>{let d="";return(o.value.length<6||o.value.length>20)&&(d+=`${v("accountLengthError")} `),/^[a-zA-Z0-9._]+$/.test(o.value)||(d+=`${v("accountSpecialCharError")} `),/[_\.]{2,}/.test(o.value)&&(d+=`${v("accountConsecutiveError")} `),(!/^[a-zA-Z0-9]/.test(o.value)||!/[a-zA-Z0-9]$/.test(o.value))&&(d+=`${v("accountStartEndError")} `),/\b(admin|root)\b/.test(o.value)&&(d+=`${v("accountReservedWordError")} `),(r.value.length<8||r.value.length>20)&&(d+=`${v("passwordLengthError")} `),(!/[a-zA-Z]/.test(r.value)||!/\d/.test(r.value))&&(d+=`${v("passwordComplexityError")} `),d})();if(f){V.create({type:"negative",message:f.trim()});return}try{await te({account:o.value,password:r.value}),V.create({type:"positive",message:v("loginSuccess")}),u.push(h),setTimeout(()=>{window.location.reload()},0)}catch(d){let I=d.message||v("loginFailed");d.message=="loginTooMany"&&(I=v("loginTooMany")),V.create({type:"negative",message:I})}},m=Q(()=>b.isDarkMode?j:O);return(l,f)=>(k(),A(S,{class:"rounded-borders"},{default:i(()=>[a(_,null,{default:i(()=>[e("div",ve,s(l.$t("welcome")),1)]),_:1}),a(_,null,{default:i(()=>[e("div",me,[e("img",{src:m.value,"spinner-color":"white",class:"login-image"},null,8,pe)]),e("div",ge,[e("div",null,s(l.$t("noAccount")),1),e("div",{style:{color:"#FDA300",cursor:"pointer","font-weight":"bold"},onClick:f[0]||(f[0]=d=>l.$emit("open-register"))},s(l.$t("clickForRegister")),1)]),a(E,{modelValue:o.value,"onUpdate:modelValue":f[1]||(f[1]=d=>o.value=d),label:l.$t("account"),outlined:"",dense:""},null,8,["modelValue","label"]),a(E,{modelValue:r.value,"onUpdate:modelValue":f[2]||(f[2]=d=>r.value=d),label:l.$t("password"),type:"password",outlined:"",dense:""},null,8,["modelValue","label"])]),_:1}),a(M,{align:"center"},{default:i(()=>[a(q,{label:l.$t("login"),color:"primary",disable:!o.value||!r.value,onClick:g,class:"login-button"},null,8,["label","disable"])]),_:1})]),_:1}))}}),$e=z(fe,[["__scopeId","data-v-514591ea"]]),he={class:"user-page-container"},we={class:"q-ml-md"},ye={class:"text-h6",style:{"font-weight":"700"}},be={class:"text-h6",style:{"font-weight":"700"}},_e={class:"text-h6",style:{"font-weight":"700"}},Ce={class:"qa-container beautiful-shadow"},Ve={class:"text-h6 flex flex-center qa-title"},ke={class:"qa-list"},Ae={class:"qa-item"},Ee={class:"q-text"},Se={class:"a-text"},Ie={class:"qa-item"},Ue={class:"q-text"},qe={class:"a-text"},Le={class:"qa-item"},Pe={class:"q-text"},Re={class:"a-text"},Be=R({__name:"UserPage",setup(C){const{t:o}=B(),r=oe(),c=re(),u=$(!1),h=$(!1),b=$(!1),v=$(!1),g=$(null),m=()=>{h.value=!1,u.value=!0},l=()=>{u.value=!1,h.value=!0},f=()=>{u.value=!1},d=()=>{h.value=!1},I=()=>{r.dialog({title:o("confirmLogout"),message:o("confirmLogoutMessage"),ok:{label:o("logout"),color:"primary"},cancel:{label:o("cancel"),color:"primary",outline:!0},persistent:!0}).onOk(()=>{c.logout(),y.logout(),L=!1,Z.push("/"),r.notify({color:"secondary",message:o("logoutSuccess")})}).onCancel(()=>{r.notify({color:"primary",message:o("logoutCanceled")})})},F=()=>{u.value=!0};let L=!1;const y=se(),W=Q(()=>{var n;const t=(n=y.permission)==null?void 0:n.toLowerCase();return o(t?`permissions.${t}`:"notLoggedIn")}),G=()=>{y.setPermission("admin"),Z.push("/menu-editor")};return le(async()=>{var t;if(!y.permission||!y.userId){u.value=!0;return}if(!L)try{await c.fetchUserInfo(parseInt(y.userId)),L=!0}catch(n){((t=n.response)==null?void 0:t.status)===401?u.value=!0:console.error("Unexpected error:",n)}}),(t,n)=>{const H=T("user-profile-component"),J=T("user-history-order-component");return k(),A(ae,{class:"q-pa-md flex flex-center"},{default:i(()=>[e("div",he,[a(S,{class:"user-profile-bar"},{default:i(()=>[a(_,{class:"row items-center"},{default:i(()=>{var p;return[a(q,{flat:"",round:"",onClick:n[0]||(n[0]=()=>{}),icon:"fas fa-user"}),e("div",we,[e("div",ye,s(((p=P(c).user)==null?void 0:p.userName)||t.$t("guest")),1),e("div",null,s(W.value),1)])]}),_:1})]),_:1}),P(y).permission?(k(),A(S,{key:0,class:"logout-bar",onClick:I},{default:i(()=>[a(_,{class:"logout-text"},{default:i(()=>[e("div",be,s(t.$t("logout")),1)]),_:1})]),_:1})):N("",!0),P(y).permission?N("",!0):(k(),A(S,{key:1,class:"logout-bar",onClick:F},{default:i(()=>[a(_,{class:"logout-text"},{default:i(()=>[e("div",_e,s(t.$t("login")),1)]),_:1})]),_:1})),a(U,{modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=p=>u.value=p)},{default:i(()=>[a($e,{onOpenRegister:l,onClose:f})]),_:1},8,["modelValue"]),a(U,{modelValue:h.value,"onUpdate:modelValue":n[2]||(n[2]=p=>h.value=p)},{default:i(()=>[a(ce,{onOpenLogin:m,onClose:d})]),_:1},8,["modelValue"]),a(U,{modelValue:b.value,"onUpdate:modelValue":n[4]||(n[4]=p=>b.value=p)},{default:i(()=>[a(H,{onClose:n[3]||(n[3]=p=>b.value=!1)})]),_:1},8,["modelValue"]),a(U,{modelValue:v.value,"onUpdate:modelValue":n[6]||(n[6]=p=>v.value=p)},{default:i(()=>[a(J,{order:g.value,onClose:n[5]||(n[5]=p=>v.value=!1)},null,8,["order"])]),_:1},8,["modelValue"])]),e("div",Ce,[e("div",Ve,s(t.$t("qaTitle")),1),e("div",ke,[e("div",Ae,[e("div",Ee,[e("strong",null,s(t.$t("question"))+":",1),w(" "+s(t.$t("passwordRevealQuestion")),1)]),e("div",Se,[e("strong",null,s(t.$t("answer"))+":",1),w(" "+s(t.$t("passwordRevealAnswerPart1"))+" "+s(t.$t("passwordRevealAnswerPart2")),1)])]),e("div",Ie,[e("div",Ue,[e("strong",null,s(t.$t("question"))+":",1),w(" "+s(t.$t("shopperQuestion")),1)]),e("div",qe,[e("strong",null,s(t.$t("answer"))+":",1),w(" "+s(t.$t("shopperAnswerPart1"))+" ",1),e("span",{class:"clickable-text",onClick:G},s(t.$t("shopperAnswerPart3")),1),w(" "+s(t.$t("shopperAnswerPart4")),1)])]),e("div",Le,[e("div",Pe,[e("strong",null,s(t.$t("question"))+":",1),w(" "+s(t.$t("selfBuildQuestion")),1)]),e("div",Re,[e("strong",null,s(t.$t("answer"))+":",1),w(" "+s(t.$t("selfBuildAnswerPart1"))+" ",1),e("a",{href:"javascript:void(0)",class:"clickable-link",onClick:n[7]||(n[7]=p=>t.$router.push("/project-details"))},s(t.$t("selfBuildAnswerPart3")),1),w(" "+s(t.$t("selfBuildAnswerPart4"))+" "+s(t.$t("selfBuildAnswerPart5"))+" ",1),e("a",{href:"javascript:void(0)",class:"clickable-link",onClick:n[8]||(n[8]=p=>t.$router.push("/feedback"))},s(t.$t("selfBuildAnswerPart7")),1),w(" "+s(t.$t("selfBuildAnswerPart8")),1)])])])])]),_:1})}}}),Ne=z(Be,[["__scopeId","data-v-faa0a4f9"]]);export{Ne as default};
